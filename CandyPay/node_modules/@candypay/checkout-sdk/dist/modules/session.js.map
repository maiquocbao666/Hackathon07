{"version":3,"sources":["../../src/modules/session.ts","../../src/constants/urls.ts","../../src/utils/paymentURL.ts","../../src/generated-config.ts"],"sourcesContent":["import axios from \"axios\";\n\nimport {\n  Config,\n  CreateSessionOptions,\n  CreateSessionResponse,\n  SessionMetadataOptions,\n  SessionMetadataResponse,\n} from \"@/interfaces\";\nimport { returnPaymentURL } from \"@/utils\";\nimport { CANDYPAY_API_URL } from \"../generated-config\";\n\nexport class Session {\n  private network: string;\n  private options: Config;\n\n  constructor(network: string, options: Config) {\n    this.network = network;\n    this.options = options;\n  }\n\n  /**\n   * Create a new checkout session\n   *\n   * @returns\n   * Returns checkout session object along with `order_id` and `payment_url`\n   * @see\n   * https://docs.candypay.fun/checkout/node-sdk.html#create\n   * @example\n   * ```ts\n   * const hipBagItem = {\n   *   name: \"Throwback Hip Bag\",\n   *   price: 4,\n   *   image: \"https://imgur.com/EntGcVQ.png\",\n   *   quantity: 5\n   * }\n   *\n   * const session = await candypay.session.create({\n   *   success_url: \"https://your-website.com/checkout/success\",\n   *   cancel_url: \"https://your-website.com/checkout/cancel\",\n   *   tokens: [\"samo\", \"shdw\"],\n   *   items: [hipBagItem],\n   *   shipping_fees: 0.43\n   * })\n   *\n   * const paymentURL = session.redirect_url\n   * ```\n   */\n  async create(options: CreateSessionOptions): Promise<CreateSessionResponse> {\n    try {\n      const parameters = {\n        ...options,\n        network: this.network,\n        config: this.options.config,\n      };\n      let response = await axios.post(\n        `${CANDYPAY_API_URL}/session`,\n        parameters,\n        {\n          headers: {\n            Authorization: `Bearer ${this.options.api_keys.private_api_key}`,\n          },\n        }\n      );\n\n      response.data.payment_url = returnPaymentURL(\n        response.data.session_id,\n        this.options.api_keys.public_api_key\n      );\n      return response.data;\n    } catch (err) {\n      throw new Error(JSON.stringify(err.response.data, null, 2));\n    }\n  }\n\n  /**\n   * Fetch metadata of a checkout session\n   * @see\n   * https://docs.candypay.fun/checkout/node-sdk.html#metadata\n   * @example\n   * ```ts\n   * const sessionID = \"cp_pay_34059991-d572-46db-bd1c-225e467ee414\"\n   *\n   * const metadata = await candypay.session.metadata({\n   *   session_id: sessionID\n   * })\n   * ```\n   */\n  async metadata(\n    options: SessionMetadataOptions\n  ): Promise<SessionMetadataResponse> {\n    try {\n      let response = await axios.get(`${CANDYPAY_API_URL}/session`, {\n        params: {\n          session_id: options.session_id,\n        },\n        headers: {\n          Authorization: `Bearer ${this.options.api_keys.public_api_key}`,\n        },\n      });\n\n      response.data.payment_url = returnPaymentURL(\n        response.data.session_id,\n        this.options.api_keys.public_api_key\n      );\n      return response.data;\n    } catch (err) {\n      throw new Error(JSON.stringify(err.response.data, null, 2));\n    }\n  }\n\n  /**\n   * Generate payment URL for a provided session ID\n   * @see\n   * https://docs.candypay.fun/checkout/node-sdk.html#generateredirecturl\n   * @example\n   * ```ts\n   * const sessionID = \"cp_pay_34059991-d572-46db-bd1c-225e467ee414\";\n   *\n   * const paymentURL = candypay.session.generatePaymentURL({\n   *   session_id: sessionID\n   * })\n   * ```\n   */\n  generatePaymentURL(options: { session_id: string }): string {\n    return returnPaymentURL(\n      options.session_id,\n      this.options.api_keys.public_api_key\n    );\n  }\n}\n","export const CONVOY_API_URL = \"https://dashboard.getconvoy.io/api/v1\";\nexport const REDIRECT_URL = \"https://checkout.candypay.fun\";\n","import { deflate } from \"pako\";\n\nimport { REDIRECT_URL } from \"@/constants\";\n\nexport const returnPaymentURL = (sessionId: string, publicApiKey: string) => {\n  const payload = {\n    sessionId,\n    publicApiKey,\n  };\n\n  const compressed = deflate(JSON.stringify(payload));\n  const base64 = Buffer.from(compressed).toString(\"base64\");\n  const url_safe_base64 = encodeURIComponent(base64);\n\n  return `${REDIRECT_URL}/pay?data=${url_safe_base64}`;\n};\n","////////////////////////////////////////////////////////////////////////////////\n// This file is generated via a pre-build step via scripts/config.sh.\n////////////////////////////////////////////////////////////////////////////////\n\nexport const CANDYPAY_CONFIG_VERSION: \"development\" | \"production\" | string = \"production\";\nexport const CANDYPAY_API_URL = \"https://candypay-checkout-production.up.railway.app/api/v1\"\n\n"],"mappings":"u+BAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GAAA,IAAAI,EAAkB,oBCCX,IAAMC,EAAe,gCCD5B,IAAAC,EAAwB,gBAIjB,IAAMC,EAAmBC,EAAA,CAACC,EAAmBC,IAAAA,CAMlD,IAAMC,KAAaC,WAAQC,KAAKC,UALhB,CACdL,UAAAA,EACAC,aAAAA,CACF,CAE0CK,CAAAA,EACpCC,EAASC,OAAOC,KAAKP,CAAAA,EAAYQ,SAAS,QAAA,EAC1CC,EAAkBC,mBAAmBL,CAAAA,EAE3C,MAAO,GAAGM,cAAyBF,GACrC,EAXgC,oBCCzB,IAAMG,EAAmB,6DHOzB,IAAMC,EAAN,KAAMA,CAIXC,YAAYC,EAAiBC,EAAiB,CAHtCD,EAAAA,gBACAC,EAAAA,gBAGN,KAAKD,QAAUA,EACf,KAAKC,QAAUA,CACjB,CA6BA,MAAMC,OAAOD,EAA+D,CAC1E,GAAI,CACF,IAAME,EAAaC,EAAAC,EAAA,GACdJ,GADc,CAEjBD,QAAS,KAAKA,QACdM,OAAQ,KAAKL,QAAQK,MACvB,GACIC,EAAW,MAAMC,EAAAA,QAAMC,KACzB,GAAGC,YACHP,EACA,CACEQ,QAAS,CACPC,cAAe,UAAU,KAAKX,QAAQY,SAASC,iBACjD,CACF,CAAA,EAGFP,OAAAA,EAASQ,KAAKC,YAAcC,EAC1BV,EAASQ,KAAKG,WACd,KAAKjB,QAAQY,SAASM,cAAc,EAE/BZ,EAASQ,IAClB,OAASK,EAAP,CACA,MAAM,IAAIC,MAAMC,KAAKC,UAAUH,EAAIb,SAASQ,KAAM,KAAM,CAAA,CAAA,CAC1D,CACF,CAeA,MAAMS,SACJvB,EACkC,CAClC,GAAI,CACF,IAAIM,EAAW,MAAMC,EAAAA,QAAMiB,IAAI,GAAGf,YAA4B,CAC5DgB,OAAQ,CACNR,WAAYjB,EAAQiB,UACtB,EACAP,QAAS,CACPC,cAAe,UAAU,KAAKX,QAAQY,SAASM,gBACjD,CACF,CAAA,EAEAZ,OAAAA,EAASQ,KAAKC,YAAcC,EAC1BV,EAASQ,KAAKG,WACd,KAAKjB,QAAQY,SAASM,cAAc,EAE/BZ,EAASQ,IAClB,OAASK,EAAP,CACA,MAAM,IAAIC,MAAMC,KAAKC,UAAUH,EAAIb,SAASQ,KAAM,KAAM,CAAA,CAAA,CAC1D,CACF,CAeAY,mBAAmB1B,EAAyC,CAC1D,OAAOgB,EACLhB,EAAQiB,WACR,KAAKjB,QAAQY,SAASM,cAAc,CAExC,CACF,EAtHarB,EAAAA,EAAAA","names":["session_exports","__export","Session","__toCommonJS","import_axios","REDIRECT_URL","import_pako","returnPaymentURL","__name","sessionId","publicApiKey","compressed","deflate","JSON","stringify","payload","base64","Buffer","from","toString","url_safe_base64","encodeURIComponent","REDIRECT_URL","CANDYPAY_API_URL","Session","constructor","network","options","create","parameters","__spreadProps","__spreadValues","config","response","axios","post","CANDYPAY_API_URL","headers","Authorization","api_keys","private_api_key","data","payment_url","returnPaymentURL","session_id","public_api_key","err","Error","JSON","stringify","metadata","get","params","generatePaymentURL"]}